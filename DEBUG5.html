<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Chair Viewer</title>
    <style>
        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            outline: none !important;
            border: none !important;
        }
        
        * {
            outline: none !important;
            border: none !important;
        }
        
        *:focus {
            outline: none !important;
            border: none !important;
        }
        
        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
            cursor: grab;
            outline: none !important;
            border: none !important;
            display: block;
        }
        
        #renderCanvas:active {
            cursor: grabbing;
        }
        
        #renderCanvas:focus {
            outline: none !important;
            border: none !important;
        }
    </style>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);
        
        var createScene = function () {
            var scene = new BABYLON.Scene(engine);
            
            // No hardware scaling degradation
            engine.setHardwareScalingLevel(1);
            
        //----CAMERA SETUP-----------------------
            
            var cameraDistance = 5;
            var cameraTargetHeight = 0.45;
            var finalAlpha = -2;
            var finalBeta = 1.38;
            var startAlpha = finalAlpha + 1.2;
            var startBeta = finalBeta - 0.4;
            
            var camera = new BABYLON.ArcRotateCamera("Camera", startAlpha, startBeta, cameraDistance, BABYLON.Vector3(0,0,0), scene);
            camera.attachControl(canvas, true);
            camera.wheelPrecision = 40;
            camera.setTarget(new BABYLON.Vector3(0, cameraTargetHeight, 0));
            camera.panningSensibility = 0;
            camera.pinchDeltaPercentage = 0.01;
            camera.fov = .3;
            camera.upperRadiusLimit = 7;
            camera.lowerRadiusLimit = 1.7;
            
            var animateCameraIn = function() {
                var animationDuration = 2000;
                var startTime = performance.now();
                
                var animate = function() {
                    var elapsed = performance.now() - startTime;
                    var progress = Math.min(elapsed / animationDuration, 1);
                    
                    var eased = progress < 0.5 
                        ? 2 * progress * progress 
                        : 1 - Math.pow(-2 * progress + 2, 2) / 2;
                    
                    camera.alpha = startAlpha + (finalAlpha - startAlpha) * eased;
                    camera.beta = startBeta + (finalBeta - startBeta) * eased;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                
                animate();
            };

        //----HDRI TEXTURE------------------------

            var hdrTexture = BABYLON.CubeTexture.CreateFromPrefilteredData("https://assets.babylonjs.com/environments/studio.env", scene);
            scene.environmentTexture = hdrTexture;
            scene.environmentIntensity = 1.2;

        //----CHAIR--------------------------------

            var modelScale = 0.01;

            var couch = BABYLON.SceneLoader.ImportMesh("", "https://dl.dropbox.com/scl/fi/5mpforjje4go75nufbtqn/NEW-BAD-CHAIR-2.glb?rlkey=he8ic20k54ajoqq1isenbxpgi&st=m2nwrmbs", "my-file.glb", scene, function (mesh) {
                const meshConstant = scene.getMeshByName("__root__");
                
                meshConstant.scaling = new BABYLON.Vector3(modelScale, modelScale, modelScale);
                
                const floorPlane = scene.getMeshByName("Plane001_FLOOR_0");
                if (floorPlane) {
                    floorPlane.isVisible = false;
                }
                
                // Full quality texture filtering
                scene.materials.forEach((material) => {
                    if (material.getActiveTextures) {
                        material.getActiveTextures().forEach((texture) => {
                            texture.updateSamplingMode(BABYLON.Texture.NEAREST_SAMPLINGMODE);
                            texture.anisotropicFilteringLevel = 1;
                        });
                    }
                });
                
                animateCameraIn();
            });

        //----BACKGROUND SETUP--------------------

            scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);

            var ground = BABYLON.Mesh.CreatePlane('ground', 1000, scene);
            ground.rotation.x = Math.PI / 2;
            ground.isVisible = false;

            return scene;

        };
        
        const scene = createScene();
        
        engine.runRenderLoop(function () {
            scene.render();
        });
        
        window.addEventListener("resize", function () {
            engine.resize();
        });
        
        canvas.addEventListener('wheel', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        canvas.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        canvas.addEventListener('gesturechange', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        canvas.addEventListener('gestureend', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        canvas.addEventListener('touchmove', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
