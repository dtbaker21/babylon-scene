<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Chair Viewer</title>
    <style>
        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        console.log("Script starting...");
        
        const canvas = document.getElementById("renderCanvas");
        console.log("Canvas element:", canvas);
        
        const engine = new BABYLON.Engine(canvas, true);
        console.log("Engine created:", engine);
        
        var createScene = function () {
            console.log("Creating scene...");
            var scene = new BABYLON.Scene(engine);
            
            // Disable hardware scaling for worse aliasing
            engine.setHardwareScalingLevel(1);
            
        //----CAMERA SETUP-----------------------
            
            // CAMERA VARIABLES - Easy adjustments
            var cameraDistance = 4.5;  // How far camera is from product (lower = closer)
            var cameraTargetHeight = 0.15;  // Height camera looks at (lower = product appears lower in frame)
            
            var camera = new BABYLON.ArcRotateCamera("Camera", -Math.PI / 2,  Math.PI / 2, cameraDistance, BABYLON.Vector3(0,0,0), scene);
            camera.attachControl(canvas, true);
            camera.wheelPrecision = 40;
            camera.setTarget(new BABYLON.Vector3(0, cameraTargetHeight, 0));
            camera.panningSensibility = 0;
            camera.pinchDeltaPercentage=0.001;
            camera.fov = .3;
            camera.beta = 1.3;
            camera.alpha = -2;
            camera.upperRadiusLimit = 7;
            camera.lowerRadiusLimit = 1.7;
            console.log("Camera created");

        //----HDRI TEXTURE------------------------

            console.log("Loading environment texture...");
            var hdrTexture = BABYLON.CubeTexture.CreateFromPrefilteredData("https://assets.babylonjs.com/environments/studio.env", scene);
            scene.environmentTexture = hdrTexture;
            scene.environmentIntensity = 1.2;
            console.log("Environment texture loaded");

        //----CHAIR--------------------------------

            // SCALE VARIABLE - adjust this to make model bigger/smaller
            var modelScale = 0.01;

            console.log("Loading chair model...");
            var couch = BABYLON.SceneLoader.ImportMesh("", "https://dl.dropbox.com/scl/fi/1pqb6h2h0nm1u2kubeafl/alarice_accent_chair_charm_cigar_leather.glb?rlkey=38i9a296jz9751osqcpachwnz&st=e7wnztjh", "my-file.glb", scene, function (mesh) {
                console.log("Chair model loaded successfully");
                const meshConstant = scene.getMeshByName("__root__");
                
                // Apply scale
                meshConstant.scaling = new BABYLON.Vector3(modelScale, modelScale, modelScale);
                
                // Hide the floor plane that came with the model
                const floorPlane = scene.getMeshByName("Plane001_FLOOR_0");
                if (floorPlane) {
                    floorPlane.isVisible = false;
                    console.log("Floor plane hidden");
                }
                
                // Degrade texture quality - disable filtering and reduce sampling
                scene.materials.forEach((material) => {
                    if (material.getActiveTextures) {
                        material.getActiveTextures().forEach((texture) => {
                            texture.updateSamplingMode(BABYLON.Texture.NEAREST_SAMPLINGMODE); // Point sampling, no filtering
                            texture.anisotropicFilteringLevel = 1; // Minimum anisotropic filtering
                        });
                    }
                });
                console.log("Textures degraded");
                
                // DEBUG: Log all meshes in the scene
                console.log("=== ALL MESHES IN SCENE ===");
                scene.meshes.forEach((m, index) => {
                    console.log(`${index}: ${m.name} - isVisible: ${m.isVisible}, receiveShadows: ${m.receiveShadows}`);
                });
                console.log("=========================");
            }, null, function(scene, message, exception) {
                console.error("Error loading chair model:", message, exception);
            });

        //----BACKGROUND SETUP--------------------

            // Transparent background
            scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);

            // Invisible ground (no shadow reception)
            var ground = BABYLON.Mesh.CreatePlane('ground', 1000, scene);
            ground.rotation.x = Math.PI / 2;
            ground.isVisible = false;
            console.log("Ground created");

            return scene;

        };
        
        console.log("About to create scene...");
        const scene = createScene();
        console.log("Scene created:", scene);
        
        engine.runRenderLoop(function () {
            scene.render();
        });
        console.log("Render loop started");
        
        window.addEventListener("resize", function () {
            engine.resize();
        });
        
        console.log("Setup complete!");
    </script>
</body>
</html>
